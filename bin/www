#!/usr/bin/env node
var app = require('../app');

app.set('port', process.env.PORT || 3000);

var server = app.listen(app.get('port'), function() {
  console.log('Express server listening on port ' + server.address().port);
});

var io = require('socket.io')(server);

io.on('connection', function(socket){

  socket.on('message', function (message) {
      // socket.get('pseudo', function (error, name) {
          var data = { 'message' : message};
          io.emit('message', data);
          console.log("send this : " + message);
      // })
  });


  socket.on('create', function (connectionData) {
    if(connectionData.type=="phone"){
      if(io.sockets.adapter.rooms[connectionData.room]){
        socket.join(connectionData.room);
        //send off notification of connection
        io.emit('alldeviceconnected', "true");
      }else{//no such room exists
        io.emit('alldeviceconnected', "false");
      }

    }else{
      socket.join(connectionData.room);
    }

  });


});
